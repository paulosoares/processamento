<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:rich="http://richfaces.org/rich">
    
    <h:form id="headerForm">
		<div class="header">
			<table>
				<tbody>
					<tr>
						<td style="text-align: left; width: 115px;">
							<h:graphicImage url="/common/images/stf-logo.png" />
						</td>
						<td style="text-align: left">
							<s:link view="/principal.xhtml" value="eSTF-Decisão" includePageParams="false" propagation="none" style="margin-right: 5px;"/>
					        <a:commandLink id="usersLink" value="(#{casAuthenticationProvider.users.size()} usuários online)" rendered="#{userFacesBean.principal.master}" reRender="usersLink, usersPanel" oncomplete="Richfaces.showModalPanel('usersPanel');" ajaxSingle="true" eventsQueue="ajaxQueue" ignoreDupResponses="true"/>
						</td>
						<td style="text-align: right">
							<h:outputText value="#{userFacesBean.principal.usuario.nome}"/>
						</td>
						<td style="text-align: right; width: 165px">
				    		<c:choose>
								<c:when test="#{not userFacesBean.acessaTodosGabinetes}">
									<c:choose>
										<c:when test="#{userFacesBean.principal.setores.size() > 1}">
											<h:selectOneMenu id="setor" value="#{userFacesBean.principal.idSetor}" style="width:150px">
												<s:selectItems var="setor" value="#{userFacesBean.principal.setores}" itemValue="#{setor.id}" label="#{setor.sigla}" noSelectionLabel="Selecione..." hideNoSelectionLabel="true"/>
												<a:support event="onchange"
													action="#{userFacesBean.changeSetor}"
													eventsQueue="ajaxQueue" ignoreDupResponses="true"
													oncomplete="document.getElementById('objetoIncidenteSearchForm:reset').click();" 
													reRender="containerPrincipalAgrupar" 
													actionListener="#{revisarListasFacesBean.agruparObjetosIncidentes}" />
												<f:convertNumber/>
											</h:selectOneMenu>
										</c:when>
										<c:otherwise>
											<h:outputText value="#{userFacesBean.principal.usuario.setor.sigla}" style="text-align:left;padding-left:5px;"/>
										</c:otherwise>
									</c:choose>
								</c:when>							
								<c:otherwise>
									<h:selectOneMenu id="setor" value="#{userFacesBean.principal.idSetor}" style="width:150px">
										<s:selectItems var="setor" value="#{userFacesBean.allSetores}" itemValue="#{setor.id}" label="#{setor.sigla}" noSelectionLabel="Selecione..."/>
										<a:support event="onchange"
											action="#{userFacesBean.changeSetor}" eventsQueue="ajaxQueue"
											ignoreDupResponses="true"
											oncomplete="document.getElementById('objetoIncidenteSearchForm:reset').click();" 
											reRender="containerPrincipalAgrupar" 
											actionListener="#{revisarListasFacesBean.agruparObjetosIncidentes}" />
										<f:convertNumber/>
									</h:selectOneMenu>
								</c:otherwise>
							</c:choose>
						</td>
						<td style="text-align: right; width: 35px;padding-left: 5px;">
							<a:commandLink value="Ajuda" onclick="#{rich:component('helpPanel')}.show()" ajaxSingle="true" eventsQueue="ajaxQueue" ignoreDupResponses="true"/>
						</td>
						<td style="text-align: right; width: 35px; padding-right: 20px;">
							<a href="#{request.contextPath}/j_spring_security_logout" onclick="return confirmarSair()">Sair</a>
						</td>
					</tr>
				</tbody>
		    </table>
	    </div>
    </h:form>
</ui:composition>    
